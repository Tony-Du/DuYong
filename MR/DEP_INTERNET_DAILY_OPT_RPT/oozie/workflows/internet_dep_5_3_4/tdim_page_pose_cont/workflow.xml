<workflow-app xmlns='uri:oozie:workflow:0.5' name='internet_dep_recom_page_content-tdim_page_pose_cont'>
	
	<!-- tdim_program_content 
	${outputTmp}/tdim_program_content	
	 PROGRAM_ID, PROGRAM_NAME, CONTENT_ID
	-->
	
	<!--tdim_sinc_cont_prog : 
	${outputTmp}/tdim_sinc_cont_prog
	CONTENT_ID, SIN_CONTENT_ID, PROGRAM_ID, PROGRAM_NAME
	-->
	
	<!-- tdim_term_prod
	${outputTmp}/tdim_term_prod
	TERM_PROD_ID, TERM_PROD_NAME
	-->	
	
	<!-- tdim_page_name_pose: 
	${outputTmp}/tdim_page_name_pose
	 PAGE_ID, PAGE_NAME, SHOW_OBJ_ID, SHOW_OBJ_NAME
	-->
	
	<!-- tdim_term_videotype 
	${outputTmp}/tdim_contet_sincont
	 CONTENT_ID, SIN_CONTENT_ID
	-->
	
	<start to="fork_tdim_page_pose_cont" />
		
	<!-- 
	<join name="join_tdim_page_pose_cont" to="XXXXXX" />
	-->
	<fork name="fork_tdim_page_pose_cont">
		<path start="tdim_program_content" />
		<path start="tdim_term_prod" />
		<path start="to_voms_show_obj_d_detail" />
		<path start="tdim_contet_sincont" />
	</fork>
	
	
	<!-- tdim_program_content 
	${outputTmp}/tdim_program_content	
	 PROGRAM_ID, PROGRAM_NAME, CONTENT_ID
	-->
	<action name="tdim_program_content">
		<java>
			<job-tracker>${jobTracker}</job-tracker>
			<name-node>${nameNode}</name-node>
			<prepare>
				<delete path="${outputTmp}/tdim_program_content" />
			</prepare>
			<configuration>
				<property>
					<name>mapred.job.queue.name</name>
					<value>${queue}</value>
				</property>
				<property>
					<name>mapred.child.java.opts</name>
					<value>-Xmx1024m</value>
				</property>
				<property>
					<name>mapred.reduce.tasks</name>
					<value>1</value>
				</property>
				<property>
					<name>NameNode</name>
					<value>${nameNode}</value>
				</property>
			</configuration>
			<main-class>com.mganaly.utils.MainRunner</main-class>
			<arg>td_oms_program_d_tool</arg>
			<arg>redNum=1</arg>
			
			<arg>outpath=${outputTmp}/tdim_program_content</arg>
			
			<arg>inpath=${cdmpPath}/td_oms_program_d</arg>
			<arg>mapKeys= PROGRAM_ID, PROGRAM_NAME</arg>
			<arg>mapVals= CONTENT_ID</arg>
			
			<capture-output />
		</java>
		<ok to="join_tdim_page_pose_cont" />
		<error to="fail" />
	</action>	
	
		
	<!-- tdim_term_prod
	${outputTmp}/tdim_term_prod
	TERM_PROD_ID, TERM_PROD_NAME
	-->
	<action name="tdim_term_prod">
		<java>
			<job-tracker>${jobTracker}</job-tracker>
			<name-node>${nameNode}</name-node>
			<prepare>
				<delete path="${outputTmp}/tdim_term_prod" />
			</prepare>
			<configuration>
				<property>
					<name>mapred.job.queue.name</name>
					<value>${queue}</value>
				</property>
				<property>
					<name>mapred.child.java.opts</name>
					<value>-Xmx1024m</value>
				</property>
				<property>
					<name>mapred.reduce.tasks</name>
					<value>1</value>
				</property>
				<property>
					<name>NameNode</name>
					<value>${nameNode}</value>
				</property>
			</configuration>
			<main-class>com.mganaly.utils.MainRunner</main-class>
			<arg>tdim_prod_id_tool</arg>
			<arg>redNum=1</arg>
			<arg>outpath=${outputTmp}/tdim_term_prod</arg>
			
			<arg>inpath=${cdmpPath}/tdim_prod_id</arg>
			
			<arg>mapKeys= TERM_PROD_ID</arg>
			<arg>mapVals=APP:MG_ShiPin</arg>
			<arg>redVals=MG_ShiPin</arg>
			<capture-output />
		</java>
		<ok to="join_tdim_page_pose_cont" />
		<error to="fail" />
	</action>
	
	
	<!-- to_voms_show_obj_d_detail: 
	${outputTmp}/to_voms_show_obj_d_detail
	 SUP_NODE_ID,
	 SHOW_OBJ_ID, SHOW_OBJ_NAME
	-->
	<action name="to_voms_show_obj_d_detail">
		<java>
			<job-tracker>${jobTracker}</job-tracker>
			<name-node>${nameNode}</name-node>
			<prepare>
				<delete path="${outputTmp}/to_voms_show_obj_d_detail" />
			</prepare>
			<configuration>
				<property>
					<name>mapred.job.queue.name</name>
					<value>${queue}</value>
				</property>
				<property>
					<name>mapred.child.java.opts</name>
					<value>-Xmx1024m</value>
				</property>
				<property>
					<name>mapred.reduce.tasks</name>
					<value>1</value>
				</property>
				<property>
					<name>NameNode</name>
					<value>${nameNode}</value>
				</property>
			</configuration>
			<main-class>com.mganaly.utils.MainRunner</main-class>
			<arg>ods_to_voms_show_obj_d_tool</arg>
			
			<arg>outpath=${outputTmp}/to_voms_show_obj_d_detail</arg>
			
			<arg>inpath=${cdmpPath}/to_voms_show_obj_d</arg>
			
			<arg>mapKeys= SUP_NODE_ID</arg>
			<arg>mapVals= SHOW_OBJ_ID, SHOW_OBJ_NAME</arg>
			<capture-output />
		</java>
		<ok to="tdim_page_name_pose" />
		<error to="fail" />
	</action>
	

	<!-- tdim_page_name_pose: 
	${outputTmp}/tdim_page_name_pose
	 PAGE_ID, PAGE_NAME, SHOW_OBJ_ID, SHOW_OBJ_NAME
	-->
	<action name="tdim_page_name_pose">
		<java>
			<job-tracker>${jobTracker}</job-tracker>
			<name-node>${nameNode}</name-node>
			<prepare>
				<delete path="${outputTmp}/tdim_page_name_pose" />
			</prepare>
			<configuration>
				<property>
					<name>mapred.job.queue.name</name>
					<value>${queue}</value>
				</property>
				<property>
					<name>mapred.child.java.opts</name>
					<value>-Xmx1024m</value>
				</property>
				<property>
					<name>mapred.reduce.tasks</name>
					<value>1</value>
				</property>
				<property>
					<name>NameNode</name>
					<value>${nameNode}</value>
				</property>
			</configuration>
			<main-class>com.mganaly.utils.MainRunner</main-class>
			<arg>map_join_tool</arg>			
			<arg>redNum=1</arg>
			
			<arg>outpath=${outputTmp}/tdim_page_name_pose</arg>
			
			<arg>inpath=${td_dep_internet_page_info}</arg>
			<arg>inpathR=${outputTmp}/to_voms_show_obj_d_detail</arg>

			<arg>mapCols= PAGE_ID, PAGE_NAME</arg>
			<arg>mapKeys= PAGE_ID</arg>
			<arg>mapVals= PAGE_NAME</arg>

			<arg>mapRCols= SUP_NODE_ID, SHOW_OBJ_ID, SHOW_OBJ_NAME</arg>
			<arg>mapRKeys= SUP_NODE_ID</arg>
			<arg>mapRVals= SHOW_OBJ_ID, SHOW_OBJ_NAME</arg>
			<capture-output />
		</java>
		<!--<ok to="join_common_data_generate" />-->
		<ok to="join_tdim_page_pose_cont" />
		<error to="fail" />
	</action>
	
	<!-- tdim_term_videotype 
	${outputTmp}/tdim_contet_sincont
	 CONTENT_ID, SIN_CONTENT_ID
	-->
	<action name="tdim_contet_sincont">
		<java>
			<job-tracker>${jobTracker}</job-tracker>
			<name-node>${nameNode}</name-node>
			<prepare>
				<delete path="${outputTmp}/tdim_contet_sincont" />
			</prepare>
			<configuration>
				<property>
					<name>mapred.job.queue.name</name>
					<value>${queue}</value>
				</property>
				<property>
					<name>mapred.child.java.opts</name>
					<value>-Xmx1024m</value>
				</property>
				<property>
					<name>mapred.reduce.tasks</name>
					<value>1</value>
				</property>
				<property>
					<name>NameNode</name>
					<value>${nameNode}</value>
				</property>
			</configuration>			
			<main-class>com.mganaly.utils.MainRunner</main-class>
			<arg>td_icms_drama_sin_rel_tool</arg>
			
			<arg>outpath=${outputTmp}/tdim_contet_sincont</arg>
			
			<arg>inpath=${cdmpPath}/td_icms_drama_sin_rel</arg>
			<arg>mapKeys= DRAMA_CONTENT_ID</arg>
			<arg>mapVals= SIN_CONTENT_ID</arg>
			
			<capture-output />
		</java>
		<ok to="join_tdim_page_pose_cont" />
		<error to="fail" />
	</action>
	
	
	<join name="join_tdim_page_pose_cont" to="tdim_sinc_cont_prog" />
	
	
	<!--tdim_sinc_cont_prog : 
	${outputTmp}/tdim_sinc_cont_prog
	CONTENT_ID, SIN_CONTENT_ID, PROGRAM_ID, PROGRAM_NAME
	-->
	<action name="tdim_sinc_cont_prog">
		<java>
			<job-tracker>${jobTracker}</job-tracker>
			<name-node>${nameNode}</name-node>
			<prepare>
				<delete path="${outputTmp}/tdim_sinc_cont_prog" />
			</prepare>
			<configuration>
				<property>
					<name>mapred.job.queue.name</name>
					<value>${queue}</value>
				</property>
				<property>
					<name>mapred.child.java.opts</name>
					<value>-Xmx1024m</value>
				</property>
				<property>
					<name>mapred.reduce.tasks</name>
					<value>1</value>
				</property>
				<property>
					<name>NameNode</name>
					<value>${nameNode}</value>
				</property>
			</configuration>
			<main-class>com.mganaly.utils.MainRunner</main-class>
			<arg>inner_join_tool</arg>
			
			<arg>outpath=${outputTmp}/tdim_sinc_cont_prog</arg>
			
			<arg>inpath=${outputTmp}/tdim_contet_sincont</arg>
			<arg>inpathR=${outputTmp}/tdim_program_content</arg>
			
			<arg>mapCols=CONTENT_ID, SIN_CONTENT_ID</arg>				
			<arg>mapKeys=CONTENT_ID</arg>
			<arg>mapVals=SIN_CONTENT_ID</arg>
			
			<arg>mapRCols=PROGRAM_ID, PROGRAM_NAME, CONTENT_ID</arg>
			<arg>mapRKeys=CONTENT_ID</arg>
			<arg>mapRVals=PROGRAM_ID, PROGRAM_NAME</arg>
			
			<capture-output />
		</java>
		<ok to="end" />
		<error to="fail" />
	</action>
	
	
	<kill name="fail">
		<message>Failed, error message[${wf:errorMessage(wf:lastErrorNode())}]
		</message>
	</kill>

	<end name="end" />
	
</workflow-app>
