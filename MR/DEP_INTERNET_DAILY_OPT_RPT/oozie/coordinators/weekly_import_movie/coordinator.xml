<coordinator-app name="coord-weekly_import_movie_use_detail"
	frequency="${frequency}" start="${start}" end="${end}" timezone="Asia/Shanghai"
	xmlns="uri:oozie:coordinator:0.1">
	<controls>
		<timeout>-1</timeout>
		<concurrency>1</concurrency>
		<execution>${execution_order}</execution>
	</controls>

	<datasets>
		<dataset name="data1" frequency="${frequency}"
			initial-instance="${start}" timezone="${timezone}">
			<uri-template>${nameNode}/user/hadoop/public/cdmp/td_aaa_bill_d/${YEAR}${MONTH}${DAY}</uri-template>
			<done-flag></done-flag>
		</dataset>
		<dataset name="data2" frequency="${frequency}"
			initial-instance="${start}" timezone="${timezone}">
			<uri-template>${nameNode}/user/hadoop/public/cdmp/td_aaa_tourist_bill_d/${YEAR}${MONTH}${DAY}</uri-template>
			<done-flag></done-flag>
		</dataset>
		<dataset name="data3" frequency="${frequency}"
			initial-instance="${start}" timezone="${timezone}">
			<uri-template>${nameNode}/user/hadoop/public/cdmp/td_pub_visit_log_d/${YEAR}${MONTH}${DAY}</uri-template>
			<done-flag></done-flag>
		</dataset>
		<dataset name="data4" frequency="${frequency}"
			initial-instance="${start}" timezone="${timezone}">
			<uri-template>${nameNode}/user/hadoop/public/cdmp/td_pub_tourist_visit_log_d/${YEAR}${MONTH}${DAY}</uri-template>
			<done-flag></done-flag>
		</dataset>
	</datasets>

	<input-events>
		<data-in name="data1_ready" dataset="data1">
			<instance>${coord:current(-1)}</instance>
		</data-in>
		<data-in name="data2_ready" dataset="data2">
			<instance>${coord:current(-1)}</instance>
		</data-in>
		<data-in name="data3_ready" dataset="data3">
			<instance>${coord:current(-1)}</instance>
		</data-in>
		<data-in name="data4_ready" dataset="data4">
			<instance>${coord:current(-1)}</instance>
		</data-in>
	</input-events>

	<action>
		<workflow>
			<app-path>
				${nameNode}/user/${coord:user()}/public/migu_analyo_ly/oozie/workflows/test/weekly_import_movie
			</app-path>
			<configuration>
				<property>
					<name>startDate</name>
					<value>${coord:dateOffset(coord:nominalTime(), -27, 'HOUR')}</value>
				</property>
				<property>
					<name>endDate</name>
					<value>${coord:dateOffset(coord:nominalTime(), -26, 'HOUR')}</value>
				</property>
			</configuration>
		</workflow>
	</action>
</coordinator-app>
